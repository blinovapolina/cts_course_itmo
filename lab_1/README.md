# Лабораторная работа №1

В данной лабораторной работе продемонстрирована конфигурация веб-сервера Nginx, а также его возмоные уязвимости.

## Реализованные функции

- **HTTPS с SSL сертификатом** - Оба сервиса работают по защищенному HTTPS протоколу
- **Принудительное перенаправление HTTP на HTTPS** - Все HTTP запросы перенаправляются на HTTPS
- **Использование alias** - Множественные конфигурации alias для различных путей и статических файлов
- **Виртуальные хосты** - Два отдельных виртуальных хоста для разных pet проектов
- **Множественные pet проекты** - VPN сервис и блог сервис работают на разных доменах

## Pet проекты

### 1. VPN сервис (vpn.test.com)

- **Порт**: 8000
- **Функции**: Установлена панель 3x-ui для создания и управления конфигурациями VPN

### 2. Блог сервис (blog.test.com)

- **Порт**: 8001
- **Функции**: Посты блога, админ панель, API эндпоинты
- **Использование alias**:
  - `/static` → `/var/www/pet-projects/blog-service/static/`
  - `/media` → `/var/www/pet-projects/blog-service/media/`
  - `/admin-panel` → `/var/www/pet-projects/blog-service/admin/`

## Детали конфигурации

### SSL конфигурация

- Сертификат: `/var/www/certificates/test.com/cert.crt`
- Приватный ключ: `/var/www/certificates/test.com/cert.key`

### Виртуальные хосты

1. **vpn.test.com** - VPN сервис с проксированием на порт 8000
2. **blog.test.com** - Блог сервис с проксированием на порт 8001

## Проверка работы


<img width="1185" height="761" alt="image" src="https://github.com/user-attachments/assets/17a7fe74-5d74-4662-ab7e-7e23e72c177d" />


Для теста были созданы простые html файлы. На скриншоте показан запрос к первому сервису (vpn.test.com). Хосты vpn.test.com и blog.test.com прописаны в файле /etc/hosts, чтобы заменить тестовым сервисом реальный сайт. 


## Задание под звездочкой

### Уязвимый сайт

Для анализа уязвимостей в веб сервере Nginx был выбран сайт: `www.crut0i.com`

### Анализ

После непродолжительного иссследования был выявлен незащищенный поддомен: `admin.crut0i.com`

Для выявления уязвимости был использован gobuster + seclists:

```Bash
gobuster dns -d crut0i.com -t 25 -w /usr/share/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt
```

Данный субдомен направляет на админ панель сервиса `3x-ui` (управление конфигурациями vpn)

> Подобные административные панели стоит скрывать, поскольку любой может попытаться подобрать username и пароль для получения несанкционированного доступа.

### Решение

Для защиты поддомена в конфигурацию nginx можно добавить фильтр по IP адресам, чтобы только указанные IP адреса имели доступ к поддомену:

```Nginx
geo $allow_ip {
    default    0;
    127.0.0.1  1;
}

server {
    listen 443 ssl;

    ssl_certificate /var/www/certificates/crut0i.com/cert.crt;
    ssl_certificate_key /var/www/certificates/crut0i.com/cert.key;

    server_name admin.crut0i.com;

    # Перенаправляем пользователя на основной домен, если IP не подходит
    if ($allow_ip = 0) { return 302 https://www.crut0i.com; }

    ...
}
```
